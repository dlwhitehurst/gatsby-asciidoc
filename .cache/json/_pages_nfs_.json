{"data":{"asciidoc":{"html":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_introduction\">1. Introduction</a></li>\n<li><a href=\"#_preliminaries\">2. Preliminaries</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_goal\">2.1. Goal</a></li>\n<li><a href=\"#_platforms\">2.2. Platforms</a></li>\n<li><a href=\"#_dependencies\">2.3. Dependencies</a></li>\n</ul>\n</li>\n<li><a href=\"#_nfs_server_installation\">3. NFS Server Installation</a></li>\n<li><a href=\"#_nfs_client_installation\">4. NFS Client Installation</a></li>\n<li><a href=\"#_bibliography\">5. Bibliography</a></li>\n<li><a href=\"#_license\">Appendix A: License</a></li>\n</ul>\n</div>\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/files.jpg\" alt=\"Files\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p><a href=\"https://site.fortytwobinary.com/\">Site Homepage</a></p>\n</div>\n<div class=\"paragraph\">\n<p><a href=\"https://apache.fortytwobinary.com/lab//welcome.html\">Lab Homepage</a></p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/vy.png\" alt=\"Company Logo\" height=\"32\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>Welcome to the FortyTwoBinary service documentation for the Network File System (NFS) on multiple platforms. This document is subject to great change and will\nbe maintained in a software repository <a href=\"https://github.com/fortytwobinary/labdocs\">here</a>.</p>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Warning</div>\n</td>\n<td class=\"content\">\nThis installation reference was drafted and is maintained as a DevOps reference to the work that occurs on the FortyTwoBinary network and infrastructure. The\npowerful command-line instructions found here, may or may not be accurate\nor timely. This warning is given to let the DevOp be aware that commands\nmay not be idempotent and before root-level (sudo) actions are taken, to\nplease think twice before hitting the Enter key.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"sidebarblock\">\n<div class=\"content\">\n<div class=\"title\">This document</div>\n<div class=\"paragraph\">\n<p>This document was written using asciidoc markup and the HTML you see is\ngenerated by a tool driven using Python called asciidoctor. This\ninstallation reference is a powerful document that can be of great value in the event of data loss, machine crashes, backups, maintenance, installations, and troubleshooting.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_introduction\">1. Introduction</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Network File System (NFS) is a distributed file system protocol originally developed by Sun Microsystems (Sun) in 1984 <a href=\"#sandberg-goldberg-kleiman-walsh-lyon\">[sandberg-goldberg-kleiman-walsh-lyon]</a> NFS allows the actual file system to reside on a single machine and then share the file system path across multiple machines.</p>\n</div>\n<div class=\"paragraph\">\n<p>The master node of the Pi tower \"Frankie\" hosts a 500 GB USB external G-Technology drive at <code>/mnt/ext</code>. This\nfilesystem is then exported to the other nodes as NFS clients.</p>\n</div>\n<div class=\"sidebarblock\">\n<div class=\"content\">\n<div class=\"title\">My Goal for NFS</div>\n<div class=\"paragraph\">\n<p>Since each of the Kubernetes nodes form a cluster of similar computers,\neach node needs a similar filesystem storage path (shared). The NFS mount\nwill be used for Persistent Volumes and Claims for K8s hostings. Any\nmachine will be able to send data to the Persistent Volume and subsequently\nthe filesystem path (shared) regardless of the worker sending the data.</p>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_preliminaries\">2. Preliminaries</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_goal\">2.1. Goal</h3>\n<div class=\"paragraph\">\n<p>The goal here is to install and maintain an NFS mount (server) on our Kubernetes\ncluster master node and share that mount (clients) on all worker nodes.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_platforms\">2.2. Platforms</h3>\n<div class=\"paragraph\">\n<p>NFS server and client software will be installed on arm64 Ubuntu 20.04 LTS.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_dependencies\">2.3. Dependencies</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Server with arm64 Ubuntu 20.04 LTS and physical volume</p>\n</li>\n<li>\n<p>Client hosts with arm64 Ubuntu 20.04</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_nfs_server_installation\">3. NFS Server Installation</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The server installation is done with the apt utility as sudo. On the master node and the node with the physical mount, install the NFS server package(s).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ sudo apt-get update\n$ sudo apt-get install -y nfs-kernel-server</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>NFS uses a file in <code>/etc</code> called <code>exports</code> to let everyone know about the new physical mount. Add this to the file <code>/etc/exports</code></p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">/mnt/ext *(rw,no_root_squash,insecure,async,no_subtree_check,anonuid=1000,anongid=1000)</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Now, let all of our system NFS clients know about the new mount.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ sudo exportfs -ra</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>We&#8217;re done here. Now let&#8217;s move on to the NFS clients.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_nfs_client_installation\">4. NFS Client Installation</h2>\n<div class=\"sectionbody\">\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Tip</div>\n</td>\n<td class=\"content\">\nRemember that the client installation here needs to be done on all nodes. I&#8217;m only describing the process once.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>The client installation is also done with the apt utility as sudo. Let&#8217;s install the client package(s).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ sudo apt-get update\n$ sudo apt-get install -y nfs-common</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Now, create a file system mount with the same path as kube-master (master node).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-bash\" data-lang=\"bash\">$ sudo mkdir /mnt/ext\n$ sudo chown -R ubuntu:ubuntu /mnt/ext/</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Ask ourselves, \"what do we know at this point?\" We have installed the NFS client software. We created a\nmapped file system path back to the master node&#8217;s physical mount. And, we&#8217;ve set ownership for the file system\nso that our user <code>ubuntu</code> can use it when it&#8217;s working.</p>\n</div>\n<div class=\"paragraph\">\n<p>Now, we&#8217;re going to add the actual NFS mount to our file system tabulation in <code>/etc/fstab</code>. Open <code>/etc/fstab</code>\nand add the following.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code>192.168.1.12:/mnt/ext /mnt/ext nfs rw 0 0</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Reboot the NFS client host, open a terminal and navigate to the mount. You should see this.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code>ubuntu@kube-worker-1:/mnt/ext$ ls\nlost+found</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>If you don&#8217;t see <code>lost+found</code> then the system did not mount the new NFS filesystem. If you do see it, we&#8217;re done.</p>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Warning</div>\n</td>\n<td class=\"content\">\nDo not just assume that a system reboot will mount <code>/mnt/ext</code> by the system just \"knowing\" to somehow call\n<code>mount /mnt/ext</code>. Two of my workers would not mount on reboot and I fixed this with adding a new service to\nsystemd. I&#8217;ll not discuss that here but did want to mention this.\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_bibliography\">5. Bibliography</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist bibliography\">\n<ul class=\"bibliography\">\n<li>\n<p><a id=\"sandberg-goldberg-kleiman-walsh-lyon\"></a>[sandberg-goldberg-kleiman-walsh-lyon] Russel Sandberg; David Goldberg; Steve Kleiman; Dan Walsh; Bob Lyon (1985). 'Design and Implementation of the Sun Network Filesystem'. USENIX. CiteSeerX 10.1.1.14.473.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_license\">Appendix A: License</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This document is licensed by the Apache License version 2.0. Currently,\nthe content in this document is being kept from the public however, in\nthe event the material contained here is willingly shared with\nothers, the license will remain unchanged and will convey with the\ntransference of the material.</p>\n</div>\n<div class=\"paragraph\">\n<p>Apache License\nVersion 2.0, January 2004\n<a href=\"http://www.apache.org/licenses/\" class=\"bare\">http://www.apache.org/licenses/</a></p>\n</div>\n<div class=\"paragraph\">\n<p>A copy has also been provided with this software repository.</p>\n</div>\n<div class=\"paragraph\">\n<p>Copyright &#169; 2021 David L Whitehurst.</p>\n</div>\n</div>\n</div>","document":{"title":"Network File System","subtitle":"","main":"Network File System"},"revision":null,"author":{"fullName":"David L. Whitehurst","firstName":"FortyTwoBinary","lastName":"Team","middleName":"","authorInitials":"FT","email":""}}},"pageContext":{"id":"bb377916-5c51-54c6-b963-6cb44bbdf8f7"}}